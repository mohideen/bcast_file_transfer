<% (success_destinations, failed_destinations) = script_result.destination_results.partition(&:success?) %>

File Transfer FAILED!

Job Name: <%= script_result.config_hash['job_name'] %>


Failures
--------
<% failed_destinations.each do |fd| %>
  dest_name: <%= fd.dest_name %>
  dest_type: <%= fd.dest_type %>

  dest_directory: <%= fd.dest_directory %>

  <% unless fd.comparison_result.success? %>
    There were comparison errors:
        error: <%= fd.comparison_result.result.error %>
        exitcode: <%= fd.comparison_result.result.exitcode %>

  <% end %>

  <% unless fd.transfer_results.map(&:success?).all? %>
    <% (successful_transfers, failed_transfers) = fd.transfer_results.partition(&:success?) %>
    <% total_transfer_count = fd.transfer_results.count %>

    <%= failed_transfers.count %> of <%= total_transfer_count %> files failed:

    <% failed_transfers.each do |t| %>
      file: <%= t.file %>, exitcode: <%= t.result.exitcode %>, error: <%= t.result.error %>

    <% end %>

    <% if successful_transfers.any? %>
      The following <%= successful_transfers.count %> transfers succeeded:
      <% successful_transfers.each do |t| %>
        file: <%= t.file %>

      <% end %>
    <% end %>

  -----------------------------

  <% end %>
<% end %>

<% if success_destinations.any? %>
  Successes
  ---------
  <% success_destinations.each do |sd| %>

    dest_name: <%= sd.dest_name %>
    dest_type: <%= sd.dest_type %>

    dest_directory: <%= sd.dest_directory %>

    <% successful_transfers = sd.transfer_results.select(&:success?) %>
    <% total_transfer_count = sd.transfer_results.count %>

    <% if total_transfer_count == 0 %>
      No files needed to be transferred.
    <% else %>
      <%= successful_transfers.count %> of <%= total_transfer_count %> files transferred successfully.

      <% successful_transfers.each do |t| %>
        file: <%= t.file %>

      <% end %>
    <% end %>
  <% end %>

  -----------------------------

<% end %>

<% if script_result.move_results.any? %>
  <%= script_result.move_results.count %> file(s) were moved on the source server:
  <% script_result.move_results.each do |m| %>
    <%= m.old_location %> to <%= m.new_location %>

  <% end %>
<% end %>

<% if script_result.prune_results.any? %>
  <%= script_result.prune_results.count %> empty directories on the source server were pruned:
  <% script_result.prune_results.each do |p| %>
    <%= p.dir_name %>

  <% end %>
<% end %>
